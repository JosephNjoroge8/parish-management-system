import{j as e}from"./app-BChuVOCF.js";import{r,u as t,H as a,L as s}from"./inertia-CDxxuqzl.js";import{A as n}from"./AuthenticatedLayout-lcZqL3KY.js";import{D as l}from"./users-CFzd3P2d.js";import{C as i}from"./credit-card-BIcWPPeF.js";import{U as d}from"./user-C2Opugs6.js";import{F as o}from"./file-text-ARosyyTD.js";import{S as m}from"./save-BN6hmcxT.js";import{A as c}from"./arrow-left-CIT1mRxv.js";import"./vendor--zLKLCTa.js";import"./app-BTIiuZaC.js";import"./transition-tl5wXdCp.js";import"./x-CTmJfQPG.js";const u=[{value:"cash",label:"Cash"},{value:"cheque",label:"Cheque"},{value:"bank_transfer",label:"Bank Transfer"},{value:"mobile_money",label:"Mobile Money"},{value:"card",label:"Card"}],x=[{value:"tithe",label:"Tithe"},{value:"offering",label:"Offering"},{value:"thanksgiving",label:"Thanksgiving"},{value:"project",label:"Project Contribution"},{value:"special",label:"Special Offering"}];function h({id:r,label:t,type:a="text",required:s=!1,placeholder:n="",className:l="",rows:i,step:d,data:o,errors:m,handleFieldChange:c}){const u="textarea"===a,x=e=>{const r=parseFloat(e);return isNaN(r)?"":new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(r)};return e.jsxs("div",{className:l,children:[e.jsxs("label",{htmlFor:r,className:"block text-sm font-medium text-gray-700 mb-2",children:[t," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),u?e.jsx("textarea",{id:r,value:o[r],onChange:e=>c(r,e.target.value),placeholder:n,rows:i||3,"aria-invalid":m[r]?"true":"false",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors "+(m[r]?"border-red-500":"border-gray-300"),required:s}):e.jsx("input",{type:a,id:r,value:o[r],onChange:e=>c(r,e.target.value),placeholder:n,"aria-invalid":m[r]?"true":"false",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors "+(m[r]?"border-red-500":"border-gray-300"),required:s,..."date"===a&&{max:(new Date).toISOString().split("T")[0]},...d&&{step:d}}),"number"===a&&o[r]&&x&&e.jsx("p",{className:"mt-1 text-sm text-green-600",children:x(o[r])}),m[r]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",role:"alert",children:m[r]})]})}function g({id:r,label:t,required:a=!1,placeholder:s="Select an option",className:n="",options:l,data:i,errors:d,handleFieldChange:o}){return e.jsxs("div",{className:n,children:[e.jsxs("label",{htmlFor:r,className:"block text-sm font-medium text-gray-700 mb-2",children:[t," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:r,value:i[r],onChange:e=>o(r,e.target.value),"aria-invalid":d[r]?"true":"false",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors "+(d[r]?"border-red-500":"border-gray-300"),required:a,children:[e.jsx("option",{value:"",children:s}),l.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]}),d[r]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",role:"alert",children:d[r]})]})}function p({auth:p,members:b=[],member_id:f}){var y,j,v;const[N,_]=r.useState(!1),[w,C]=r.useState(""),[F,S]=r.useState(b),[E,q]=r.useState(!1),T=r.useRef(null),{data:k,setData:I,post:A,processing:D,errors:R,clearErrors:B}=t({member_id:(null==f?void 0:f.toString())||"",amount:"",payment_date:(new Date).toISOString().split("T")[0],payment_method:"",reference_number:"",offering_type:"tithe",received_by:p.user.name,notes:""});r.useEffect(()=>{if(""===w.trim())S(b),q(!1),""!==k.member_id&&I("member_id","");else{const e=w.toLowerCase(),r=b.filter(r=>r.first_name.toLowerCase().includes(e)||r.last_name.toLowerCase().includes(e)||r.member_number.toLowerCase().includes(e));S(r),q(r.length>0)}},[w,b]);r.useEffect(()=>{const e=e=>{T.current&&!T.current.contains(e.target)&&q(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),r.useEffect(()=>{const e="cash"!==k.payment_method&&""!==k.payment_method;_(e),"cash"===k.payment_method&&k.reference_number&&I("reference_number","")},[k.payment_method]);const L=(e,r)=>{I(e,r),R[e]&&B(e)};return e.jsxs(n,{header:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(s,{href:route("tithes.index"),className:"text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(c,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Add New Tithing Record"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Record a new tithe, offering, or contribution"})]})]}),children:[e.jsx(a,{title:"Add New Tithing Record"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-green-100 rounded-full p-2",children:e.jsx(l,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Financial Contribution"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Enter the details of the financial contribution"})]})]})}),e.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{var e,r,t,a,s,n;const l=["member_id","amount","payment_date","payment_method","offering_type","received_by"];for(const d of l)if(!(null==(e=k[d])?void 0:e.trim()))return null==(r=document.getElementById(d))||r.focus(),!1;const i=parseFloat(k.amount);if(isNaN(i)||i<=0)return null==(t=document.getElementById("amount"))||t.focus(),!1;if(k.payment_date&&new Date(k.payment_date)>new Date)return null==(a=document.getElementById("payment_date"))||a.focus(),!1;return!(N&&!(null==(s=k.reference_number)?void 0:s.trim())&&(null==(n=document.getElementById("reference_number"))||n.focus(),1))})())return;B();const r={...k,tithe_type:k.offering_type,date_given:k.payment_date,recorded_by:k.received_by};delete r.offering_type,delete r.payment_date,delete r.received_by,A(route("tithes.store"),{...r,onError:e=>{var r;const t=Object.keys(e)[0];t&&(null==(r=document.getElementById(t))||r.focus())},onSuccess:()=>{C(""),q(!1),window.alert("Contribution recorded successfully!")}})},noValidate:!0,children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"relative",id:"member-autocomplete",ref:T,children:[e.jsxs("label",{htmlFor:"member_input",className:"block text-sm font-medium text-gray-700 mb-2",children:["Member ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"member_input",type:"text",value:w,onChange:e=>{C(e.target.value),k.member_id&&I("member_id",""),q(!0)},placeholder:"Type member name or number",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors "+(R.member_id?"border-red-500":"border-gray-300"),autoComplete:"off",required:!0,onFocus:()=>{F.length>0&&w&&q(!0)}}),E&&w&&F.length>0&&!k.member_id&&e.jsx("ul",{className:"absolute z-10 bg-white border border-gray-200 rounded shadow mt-1 max-h-48 overflow-y-auto w-full",children:F.slice(0,10).map(r=>e.jsxs("li",{className:"px-4 py-2 hover:bg-green-100 cursor-pointer",onClick:()=>(e=>{I("member_id",e.id.toString()),C(`${e.first_name} ${e.last_name} (${e.member_number})`),S([e]),q(!1)})(r),children:[r.first_name," ",r.last_name," (",r.member_number,")"]},r.id))}),R.member_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",role:"alert",children:R.member_id})]}),e.jsx(g,{id:"offering_type",label:"Contribution Type",required:!0,placeholder:"Select Type",options:x,data:k,errors:R,handleFieldChange:L})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(l,{className:"w-5 h-5 mr-2 text-green-600"}),"Amount & Date"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(h,{id:"amount",label:"Amount",type:"number",step:"0.01",required:!0,placeholder:"0.00",data:k,errors:R,handleFieldChange:L}),e.jsx(h,{id:"payment_date",label:"Payment Date",type:"date",required:!0,data:k,errors:R,handleFieldChange:L})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(i,{className:"w-5 h-5 mr-2 text-green-600"}),"Payment Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(g,{id:"payment_method",label:"Payment Method",required:!0,placeholder:"Select Payment Method",options:u,data:k,errors:R,handleFieldChange:L}),N&&e.jsx(h,{id:"reference_number",label:"Reference Number",required:N,placeholder:"Transaction/Cheque number",data:k,errors:R,handleFieldChange:L})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(d,{className:"w-5 h-5 mr-2 text-green-600"}),"Recording Information"]}),e.jsx(h,{id:"received_by",label:"Received By",required:!0,placeholder:"Name of person receiving the contribution",data:k,errors:R,handleFieldChange:L})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(o,{className:"w-5 h-5 mr-2 text-green-600"}),"Additional Information"]}),e.jsx(h,{id:"notes",label:"Notes",type:"textarea",placeholder:"Any additional information about this contribution...",rows:4,data:k,errors:R,handleFieldChange:L})]}),k.amount&&k.offering_type&&k.member_id&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-medium text-green-900 mb-2",children:"Contribution Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-700",children:"Member:"}),e.jsxs("div",{className:"text-green-900",children:[null==(y=b.find(e=>e.id.toString()===k.member_id))?void 0:y.first_name," ",null==(j=b.find(e=>e.id.toString()===k.member_id))?void 0:j.last_name]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-700",children:"Type:"}),e.jsx("div",{className:"text-green-900",children:null==(v=x.find(e=>e.value===k.offering_type))?void 0:v.label})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-700",children:"Amount:"}),e.jsx("div",{className:"text-green-900 font-bold",children:new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(parseFloat(k.amount))})]})]})]})]}),e.jsxs("div",{className:"flex justify-end items-center px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-lg space-x-3",children:[e.jsx(s,{href:route("tithes.index"),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:D,className:"px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg flex items-center space-x-2 transition-colors disabled:opacity-50 "+(D?"cursor-not-allowed":""),children:D?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4 mr-2",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]}),e.jsx("span",{children:"Recording..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:"Record Contribution"})]})})]})]})]})})})]})}export{h as FormField,g as SelectField,p as default};
