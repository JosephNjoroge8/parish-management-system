import{j as e,C as s,I as t,X as l}from"./app-CSiz3b5K.js";import{r,u as a,H as i,L as d}from"./inertia-CDxxuqzl.js";import{A as c}from"./AuthenticatedLayout-DT0Mn9x6.js";import{U as n}from"./users-CGfqwTuO.js";import{F as m}from"./file-spreadsheet-BZVuTuZ1.js";import{T as o}from"./trending-up-PNayJZ5b.js";import{A as x}from"./activity-C62FfAJd.js";import{U as h}from"./upload-IB7v7L0-.js";import{L as u}from"./loader-circle-D87Yz5E-.js";import{C as p}from"./circle-alert-AtuOFGsP.js";import{C as g}from"./clock-BGMYBpcc.js";import{A as j}from"./arrow-left-CKloP-DQ.js";import{D as f}from"./download-D134NaW7.js";import"./vendor--zLKLCTa.js";import"./app-B5CVx4Nu.js";import"./transition-tl5wXdCp.js";import"./user-plus-iz1tdUd0.js";function b({auth:b,stats:N}){var v,y,w;const[k,_]=r.useState(!1),[C,S]=r.useState(null),[F,I]=r.useState(!1),[M,R]=r.useState(!1),[D,U]=r.useState(0),[L,T]=r.useState(null),[E,V]=r.useState([]),[A,P]=r.useState(!1),q=r.useRef(null),{data:z,setData:O,post:X,processing:B}=a({file:null,update_existing:!0,skip_duplicates:!1,validate_families:!0}),H=r.useCallback(e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?_(!0):"dragleave"===e.type&&_(!1)},[]),W=r.useCallback(e=>{e.preventDefault(),e.stopPropagation(),_(!1);const s=Array.from(e.dataTransfer.files);s.length>0&&$(s[0])},[]),$=r.useCallback(e=>{["text/csv","application/vnd.ms-excel"].includes(e.type)||e.name.endsWith(".csv")?e.size>5242880?alert("File size must be less than 5MB"):(T(e),O("file",e),G(e)):alert("Please select a CSV file")},[O]),G=r.useCallback(e=>{const s=new FileReader;s.onload=e=>{var s;const t=(null==(s=e.target)?void 0:s.result).split("\n").slice(0,6).map(e=>e.split(",").map(e=>e.trim().replace(/"/g,"")));V(t),P(!0)},s.readAsText(e)},[]),K=r.useCallback(e=>{const s=e.target.files;s&&s.length>0&&$(s[0])},[$]),J=r.useCallback(async()=>{try{const e=await fetch(route("members.import-template"),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(e.ok){const s=await e.blob(),t=window.URL.createObjectURL(s),l=document.createElement("a");l.href=t,l.download="members_import_template.csv",document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(t),document.body.removeChild(l)}else alert("Failed to download template")}catch(e){alert("Failed to download template")}},[]),Q=r.useCallback(async()=>{var e;if(!L)return void alert("Please select a file to import");R(!0),U(10);const s=new FormData;s.append("file",L),s.append("update_existing",z.update_existing?"1":"0"),s.append("skip_duplicates",z.skip_duplicates?"1":"0"),s.append("validate_families",z.validate_families?"1":"0");try{U(30);const t=await fetch(route("members.import"),{method:"POST",body:s,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":(null==(e=document.querySelector('meta[name="csrf-token"]'))?void 0:e.getAttribute("content"))||""}});U(70);const l=await t.json();if(!t.ok||!l.success)throw new Error(l.error||l.message||"Import failed");U(100),S(l),setTimeout(()=>{T(null),O("file",null),P(!1),U(0),q.current&&(q.current.value="")},2e3)}catch(t){U(0),S({success:!1,message:t instanceof Error?t.message:"Import failed",imported:0,updated:0,skipped:0,errors:[t instanceof Error?t.message:"Unknown error"],warnings:[],total_processed:0})}finally{R(!1)}},[L,z]),Y=r.useCallback(()=>{T(null),O("file",null),P(!1),S(null),q.current&&(q.current.value="")},[O]);return e.jsxs(c,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(d,{href:route("members.index"),className:"text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(j,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Import Members"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Upload a CSV file to import multiple members at once"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:J,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Download Template"]}),e.jsxs(d,{href:route("members.index"),className:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-lg font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 transition-colors",children:[e.jsx(n,{className:"w-4 h-4 mr-2"}),"View Members"]})]})]}),children:[e.jsx(i,{title:"Import Members"}),e.jsx("div",{className:"py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(n,{className:"h-8 w-8 text-blue-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Total Members"}),e.jsx("dd",{className:"text-2xl font-bold text-gray-900",children:(null==(v=null==N?void 0:N.total_members)?void 0:v.toLocaleString())||0})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(m,{className:"h-8 w-8 text-green-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Max File Size"}),e.jsx("dd",{className:"text-2xl font-bold text-gray-900",children:(null==N?void 0:N.max_file_size)||"5MB"})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(o,{className:"h-8 w-8 text-purple-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Max Records"}),e.jsx("dd",{className:"text-2xl font-bold text-gray-900",children:(null==(y=null==N?void 0:N.max_records)?void 0:y.toLocaleString())||1e3})]})})]})})}),e.jsx("div",{className:"bg-white overflow-hidden shadow-sm rounded-lg border border-gray-200",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(x,{className:"h-8 w-8 text-orange-600"})}),e.jsx("div",{className:"ml-5 w-0 flex-1",children:e.jsxs("dl",{children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500 truncate",children:"Recent Imports"}),e.jsx("dd",{className:"text-2xl font-bold text-gray-900",children:(null==(w=null==N?void 0:N.recent_imports)?void 0:w.length)||0})]})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Upload CSV File"}),e.jsxs("div",{className:"relative border-2 border-dashed rounded-lg p-6 transition-colors "+(k?"border-blue-400 bg-blue-50":L?"border-green-400 bg-green-50":"border-gray-300 hover:border-gray-400"),onDragEnter:H,onDragLeave:H,onDragOver:H,onDrop:W,children:[e.jsx("input",{ref:q,type:"file",accept:".csv",onChange:K,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsx("div",{className:"text-center",children:L?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(s,{className:"mx-auto h-12 w-12 text-green-400"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900",children:L.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[(L.size/1024/1024).toFixed(2)," MB"]}),e.jsx("button",{onClick:Y,className:"mt-2 text-sm text-red-600 hover:text-red-500",children:"Remove file"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Drop your CSV file here"}),e.jsx("p",{className:"text-sm text-gray-500",children:"or click to browse files"})]})]})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("button",{onClick:()=>I(!F),className:"flex items-center text-sm font-medium text-gray-700 hover:text-gray-900",children:["Advanced Options",e.jsx(t,{className:"ml-1 h-4 w-4"})]}),F&&e.jsxs("div",{className:"mt-4 space-y-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"update_existing",type:"checkbox",checked:z.update_existing,onChange:e=>O("update_existing",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"update_existing",className:"ml-2 block text-sm text-gray-900",children:"Update existing members"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"skip_duplicates",type:"checkbox",checked:z.skip_duplicates,onChange:e=>O("skip_duplicates",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"skip_duplicates",className:"ml-2 block text-sm text-gray-900",children:"Skip duplicate entries"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"validate_families",type:"checkbox",checked:z.validate_families,onChange:e=>O("validate_families",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"validate_families",className:"ml-2 block text-sm text-gray-900",children:"Validate family references"})]})]})]}),M&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Importing members..."}),e.jsxs("span",{className:"text-sm text-gray-500",children:[D,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${D}%`}})})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:Q,disabled:!L||M,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:M?e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 mr-2 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Import Members"]})})})]})}),A&&E.length>0&&e.jsx("div",{className:"mt-8 bg-white shadow-sm rounded-lg border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"File Preview"}),e.jsx("button",{onClick:()=>P(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(l,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:"min-w-full divide-y divide-gray-200",children:e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:E.map((s,t)=>e.jsx("tr",{className:0===t?"bg-gray-50":"",children:s.map((s,l)=>e.jsx("td",{className:"px-3 py-2 text-sm "+(0===t?"font-medium text-gray-900":"text-gray-700"),children:s||"-"},l))},t))})})}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Showing first 5 rows of your file"})]})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Import Instructions"}),e.jsxs("div",{className:"space-y-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5",children:"1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Download Template"}),e.jsx("p",{children:"Start with our CSV template to ensure proper formatting"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5",children:"2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Fill Required Fields"}),e.jsx("p",{children:"Ensure first_name, last_name, local_church, church_group, date_of_birth, and gender are included"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-medium mr-3 mt-0.5",children:"3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Upload & Import"}),e.jsx("p",{children:"Upload your CSV file and review the preview before importing"})]})]})]}),e.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx(p,{className:"h-5 w-5 text-yellow-400 mr-2"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"Important Notes:"}),e.jsxs("ul",{className:"mt-1 list-disc list-inside text-yellow-700 space-y-1",children:[e.jsx("li",{children:"Maximum file size: 5MB"}),e.jsx("li",{children:"Supported format: CSV only"}),e.jsx("li",{children:"Existing members will be updated if found"}),e.jsx("li",{children:"Invalid records will be skipped"})]})]})]})})]})}),C&&e.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Import Results"}),C.success?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-green-600",children:[e.jsx(s,{className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"font-medium",children:"Import Successful!"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:C.imported}),e.jsx("div",{className:"text-green-700",children:"New Members"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:C.updated}),e.jsx("div",{className:"text-blue-700",children:"Updated"})]}),e.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:C.skipped}),e.jsx("div",{className:"text-yellow-700",children:"Skipped"})]}),e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:C.total_processed}),e.jsx("div",{className:"text-gray-700",children:"Total Processed"})]})]}),C.errors.length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("h4",{className:"text-sm font-medium text-red-800 mb-2",children:["Errors (",C.errors.length,"):"]}),e.jsxs("div",{className:"text-sm text-red-700 max-h-32 overflow-y-auto",children:[C.errors.slice(0,5).map((s,t)=>e.jsxs("p",{className:"mb-1",children:["• ",s]},t)),C.errors.length>5&&e.jsxs("p",{className:"text-red-600 font-medium",children:["... and ",C.errors.length-5," more errors"]})]})]}),e.jsxs("div",{className:"mt-4 flex space-x-3",children:[e.jsx(d,{href:route("members.index"),className:"flex-1 bg-blue-600 text-white text-center py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:"View Members"}),e.jsx("button",{onClick:()=>S(null),className:"flex-1 bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition-colors",children:"Import More"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center text-red-600",children:[e.jsx(p,{className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"font-medium",children:"Import Failed"})]}),e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("p",{className:"text-sm text-red-700",children:C.message}),C.errors.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"text-sm font-medium text-red-800",children:"Errors:"}),C.errors.map((s,t)=>e.jsxs("p",{className:"text-sm text-red-700",children:["• ",s]},t))]})]}),e.jsx("button",{onClick:()=>S(null),className:"w-full bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors",children:"Try Again"})]})]})}),(null==N?void 0:N.recent_imports)&&N.recent_imports.length>0&&e.jsx("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Recent Imports"}),e.jsx("div",{className:"space-y-3",children:N.recent_imports.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(g,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[s.records," records"]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.date).toLocaleDateString()})]})]}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("success"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:s.status})]},t))})]})})]})]})]})})]})}export{b as default};
