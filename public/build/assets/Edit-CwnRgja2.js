import{j as e}from"./app-CE4iXgnb.js";import{r,u as t,H as s,L as a}from"./inertia-CDxxuqzl.js";import{A as l}from"./AuthenticatedLayout-CAzOOrEZ.js";import{D as n}from"./users-Dbj6gQ98.js";import{C as i}from"./credit-card-DB0ThzFN.js";import{U as d}from"./user-CeRFzDY8.js";import{F as o}from"./file-text-j-URzPkl.js";import{S as c}from"./save-Bel763m4.js";import{T as m}from"./trash-2-DKnT_7c8.js";import{L as x}from"./loader-circle-ByBbcD6p.js";import{A as u}from"./arrow-left-kjLDD8xV.js";import"./vendor--zLKLCTa.js";import"./app-BHp0F1kE.js";import"./transition-tl5wXdCp.js";import"./user-plus-D75hMPXL.js";const h=[{value:"cash",label:"Cash"},{value:"cheque",label:"Cheque"},{value:"bank_transfer",label:"Bank Transfer"},{value:"mobile_money",label:"Mobile Money"},{value:"card",label:"Card"}],g=[{value:"tithe",label:"Tithe"},{value:"offering",label:"Offering"},{value:"thanksgiving",label:"Thanksgiving"},{value:"project",label:"Project Contribution"},{value:"special",label:"Special Offering"}];function p({auth:p,record:b,members:j}){var f,y,v,N,_,w,C;const[k,D]=r.useState(!1),[S,q]=r.useState(!1),[T,E]=r.useState(!1),{data:R,setData:F,put:B,processing:I,errors:A,clearErrors:$,delete:L}=t({member_id:(null==(f=null==b?void 0:b.member_id)?void 0:f.toString())||"",amount:(null==(y=null==b?void 0:b.amount)?void 0:y.toString())||"",payment_date:(null==b?void 0:b.payment_date)||"",payment_method:(null==b?void 0:b.payment_method)||"",reference_number:(null==b?void 0:b.reference_number)||"",offering_type:(null==b?void 0:b.offering_type)||"",received_by:(null==b?void 0:b.received_by)||"",notes:(null==b?void 0:b.notes)||""}),M=(null==(N=null==(v=null==p?void 0:p.user)?void 0:v.permissions)?void 0:N.can_edit_tithing)??!0,P=(null==(w=null==(_=null==p?void 0:p.user)?void 0:_.permissions)?void 0:w.can_delete_tithing)??!0;r.useEffect(()=>{E("cash"!==R.payment_method&&null!==R.payment_method&&void 0!==R.payment_method),"cash"===R.payment_method&&F("reference_number","")},[R.payment_method]);const U=r.useCallback((e,r)=>{F(e,r),A[e]&&$(e)},[F,A,$]),O=r.useCallback(()=>{var e,r,t,s,a,l;const n=["member_id","amount","payment_date","payment_method","offering_type","received_by"];for(const d of n)if(!(null==(e=R[d])?void 0:e.trim()))return null==(r=document.getElementById(d))||r.focus(),!1;const i=parseFloat(R.amount);if(isNaN(i)||i<=0)return null==(t=document.getElementById("amount"))||t.focus(),!1;if(R.payment_date){if(new Date(R.payment_date)>new Date)return null==(s=document.getElementById("payment_date"))||s.focus(),!1}return!(T&&!(null==(a=R.reference_number)?void 0:a.trim()))||(null==(l=document.getElementById("reference_number"))||l.focus(),!1)},[R,T]),H=r.useCallback(e=>{e.preventDefault(),O()&&($(),parseFloat(R.amount),B(route("tithing.update",b.id),{onError:e=>{var r;const t=Object.keys(e)[0];t&&(null==(r=document.getElementById(t))||r.focus())}}))},[O,$,B,b.id,R]),K=r.useCallback(()=>{(null==b?void 0:b.id)&&(q(!0),L(route("tithing.destroy",b.id),{onError:()=>{q(!1),alert("Failed to delete tithing record. Please try again.")},onFinish:()=>{q(!1),D(!1)}}))},[L,null==b?void 0:b.id]),V=e=>{const r="string"==typeof e?parseFloat(e):e;return isNaN(r)?"":new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES"}).format(r)},z=({id:r,label:t,type:s="text",required:a=!1,placeholder:l="",className:n="",rows:i,step:d})=>{const o="textarea"===s,c=o?"textarea":"input";return e.jsxs("div",{className:n,children:[e.jsxs("label",{htmlFor:r,className:"block text-sm font-medium text-gray-700 mb-2",children:[t," ",a&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(c,{...!o&&{type:s},...o&&{rows:i||3},...d&&{step:d},id:r,value:R[r],onChange:e=>U(r,e.target.value),placeholder:l,disabled:!M,"aria-invalid":A[r]?"true":"false",className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors ${A[r]?"border-red-500":"border-gray-300"} ${M?"":"bg-gray-100 cursor-not-allowed"}`,required:a,..."date"===s&&{max:(new Date).toISOString().split("T")[0]}}),"number"===s&&R[r]&&e.jsx("p",{className:"mt-1 text-sm text-green-600",children:V(R[r])}),A[r]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",role:"alert",children:A[r]})]})},Y=({id:r,label:t,required:s=!1,placeholder:a="Select an option",className:l="",options:n})=>e.jsxs("div",{className:l,children:[e.jsxs("label",{htmlFor:r,className:"block text-sm font-medium text-gray-700 mb-2",children:[t," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:r,value:R[r],onChange:e=>U(r,e.target.value),disabled:!M,"aria-invalid":A[r]?"true":"false",className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors ${A[r]?"border-red-500":"border-gray-300"} ${M?"":"bg-gray-100 cursor-not-allowed"}`,required:s,children:[e.jsx("option",{value:"",children:a}),n.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]}),A[r]&&e.jsx("p",{className:"mt-1 text-sm text-red-600",role:"alert",children:A[r]})]});return b?e.jsxs(l,{header:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(a,{href:route("tithing.index"),className:"text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(u,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:[M?"Edit":"View"," Tithing Record"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[b.member.first_name," ",b.member.last_name," - ",V(b.amount)]})]})]}),P&&e.jsxs("button",{onClick:()=>D(!0),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",disabled:S,children:[S?e.jsx(x,{className:"w-4 h-4 animate-spin"}):e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:S?"Deleting...":"Delete Record"})]})]}),children:[e.jsx(s,{title:`Edit Tithing Record - ${V(b.amount)}`}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:[!M&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-yellow-800 text-sm",children:"You have read-only access. Contact an administrator to make changes."})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-green-100 rounded-full p-2",children:e.jsx(n,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Financial Contribution"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Update the contribution record details"})]})]})}),e.jsxs("form",{onSubmit:H,noValidate:!0,children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Y,{id:"member_id",label:"Member",required:!0,placeholder:"Select Member",options:j.map(e=>({value:e.id.toString(),label:`${e.first_name} ${e.last_name} (${e.member_number})`}))}),e.jsx(Y,{id:"offering_type",label:"Contribution Type",required:!0,placeholder:"Select Type",options:g})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(n,{className:"w-5 h-5 mr-2 text-green-600"}),"Amount & Date"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(z,{id:"amount",label:"Amount",type:"number",step:"0.01",required:!0,placeholder:"0.00"}),e.jsx(z,{id:"payment_date",label:"Payment Date",type:"date",required:!0})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(i,{className:"w-5 h-5 mr-2 text-green-600"}),"Payment Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(Y,{id:"payment_method",label:"Payment Method",required:!0,placeholder:"Select Payment Method",options:h}),T&&e.jsx(z,{id:"reference_number",label:"Reference Number",required:T,placeholder:"Transaction/Cheque number"})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(d,{className:"w-5 h-5 mr-2 text-green-600"}),"Recording Information"]}),e.jsx(z,{id:"received_by",label:"Received By",required:!0,placeholder:"Name of person receiving the contribution"})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsxs("h4",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[e.jsx(o,{className:"w-5 h-5 mr-2 text-green-600"}),"Additional Information"]}),e.jsx(z,{id:"notes",label:"Notes",type:"textarea",placeholder:"Any additional information about this contribution...",rows:4})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Record History"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Created:"})," ",new Date(b.created_at).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Last Updated:"})," ",new Date(b.updated_at).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex justify-end items-center px-6 py-4 bg-gray-50 border-t border-gray-200 rounded-b-lg space-x-3",children:[e.jsx(a,{href:route("tithing.index"),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:M?"Cancel":"Back to Records"}),M&&e.jsxs("button",{type:"submit",disabled:I,className:"px-6 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg flex items-center space-x-2 transition-colors disabled:opacity-50",children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:I?"Updating...":"Update Record"})]})]})]})]})]})}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(m,{className:"w-6 h-6 text-red-600"})}),e.jsx("div",{className:"ml-3",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Delete Tithing Record"})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Are you sure you want to delete this ",null==(C=g.find(e=>e.value===b.offering_type))?void 0:C.label.toLowerCase()," record of"," ",e.jsx("strong",{children:V(b.amount)})," from"," ",e.jsxs("strong",{children:[b.member.first_name," ",b.member.last_name]}),"? This action cannot be undone."]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>D(!1),disabled:S,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{onClick:K,disabled:S,className:"flex-1 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors disabled:opacity-50 flex items-center justify-center space-x-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Deleting..."})]}):e.jsx("span",{children:"Delete Record"})})]})]})})]}):e.jsxs(l,{children:[e.jsx(s,{title:"Record Not Found"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[e.jsx("p",{className:"text-red-800",children:"Tithing record not found or access denied."}),e.jsx(a,{href:route("tithing.index"),className:"mt-4 inline-block bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Back to Tithing Records"})]})})})]})}export{p as default};
